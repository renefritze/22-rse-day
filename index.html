<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <title>Automate More - Remember Less</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/black.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/zenburn.css" />
    <link rel="stylesheet" href="./edit/style.css">

    </head>
    
    <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

#  Automate More - Remember Less

[Ren√© Fritze](mailto:rene.fritze@wwu.de)

<small>Research Software Engineering Day 2022</small>

<small>March 23th, 2022</small>
</script></section><section  data-markdown><script type="text/template">

# About Me

- [pyMOR](https://pymor.org)
- [MaRDI4NFDI](https://www.mardi4nfdi.de/about/mission)
- [dune-gdt](https://docs.dune-gdt.org/main/index.html)
- [github](https://github.com/renefritze/)
- [WWU](https://www.uni-muenster.de/AMM/en/ohlberger/team/rene_fritze.shtml)

</script></section><section ><section data-markdown><script type="text/template">

# Why automate tasks

</script></section><section data-markdown><script type="text/template">

### Why automate tasks

1. So I cannot forget (how) to run the task

</script></section><section data-markdown><script type="text/template">

### Why automate tasks

2. Increase reliability

</script></section><section data-markdown><script type="text/template">

### Why automate tasks

3. Save myself time

</script></section><section data-markdown><script type="text/template">

### Why automate tasks

4. It's fun

</script></section></section><section ><section data-markdown><script type="text/template">

# Caveats

</script></section><section data-markdown><script type="text/template">

![](automation.png)

[source](https://xkcd.com/1319/)

</script></section><section data-markdown><script type="text/template">

![](is_it_worth_the_time.png)

[source](https://xkcd.com/1205/)

</script></section></section><section ><section data-markdown><script type="text/template">

# pre-commit

General framework for git [pre-commit](https://pre-commit.com/) hooks.

</script></section><section data-markdown><script type="text/template">

### Available hooks

- formatter: black, prettier, clang-format

</script></section><section data-markdown><script type="text/template">

### black example

<pre class="python"><code data-noescape>
foo =    ('bar'
    +
                    'baz'
        )
</code></pre>

</script></section><section data-markdown><script type="text/template">

### black example

<pre class="python"><code data-noescape>
foo = "bar" + "baz"
</code></pre>

</script></section><section data-markdown><script type="text/template">

### Available hooks

- detect: large files, leaked credentials, broken symlinks

</script></section><section data-markdown><script type="text/template">

### Available hooks

- fixes: trailing whitespace, file encondings

</script></section><section data-markdown><script type="text/template">

### Available hooks

- linting

</script></section><section data-markdown><script type="text/template">

### Available hooks

- [many, MANY more](https://pre-commit.com/hooks.html)

</script></section><section data-markdown><script type="text/template">

## Real-world example

[.pre-commit-config.yaml](https://github.com/renefritze/22-rse-day/blob/main/.pre-commit-config.yaml)

<pre class="yaml"><code data-trim data-noescape>
repos:
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.1.0
    hooks:
    -   id: trailing-whitespace
    -   id: end-of-file-fixer
    -   id: check-yaml
    -   id: check-added-large-files
    -   id: check-executables-have-shebangs
    -   id: check-case-conflict
    -   id: check-symlinks
</code></pre>

<pre class="bash"><code data-trim data-noescape>
python3 -m pip install pre-commit
pre-commit run -a
</code></pre>

</script></section><section data-markdown><script type="text/template">

## Write your own hook

Lots of supported languages. Needs a repo with [metadata file](https://github.com/pre-commit/mirrors-clang-format/blob/master/.pre-commit-hooks.yaml) and optionally executable script.

[Docs](https://pre-commit.com/index.html#new-hooks)

</script></section></section><section ><section data-markdown><script type="text/template">

# Makefiles

[History](https://en.wikipedia.org/wiki/Make_(software))

</script></section><section data-markdown><script type="text/template">

### Makefiles are good for

- repeatably executing scripts
- managing dependencies between steps

</script></section><section data-markdown><script type="text/template">

### Makefiles are good for

- expressing workflows
- running things in parallel

</script></section><section data-markdown><script type="text/template">

## Rule example

<pre class="makefile"><code data-trim data-noescape>
html:
    node ./node_modules/reveal-md/bin/reveal-md.js slides/fritze2022_22__rse__day_slides.md --static docs \--template slides/template.html
</code></pre>

</script></section><section data-markdown><script type="text/template">

## Working Rule example

<pre class="makefile"><code data-trim data-noescape>
.PHONY: html
html:
    node ./node_modules/reveal-md/bin/reveal-md.js slides/fritze2022_22__rse__day_slides.md --static docs \--template slides/template.html
</code></pre>

</script></section><section data-markdown><script type="text/template">

## Better Rule example

<pre class="makefile"><code data-trim data-noescape>
docs/index.html: slides/fritze2022_22__rse__day_slides.md
    node ./node_modules/reveal-md/bin/reveal-md.js slides/fritze2022_22__rse__day_slides.md --static docs --template slides/template.html
</code></pre>

</script></section><section data-markdown><script type="text/template">

### Why I use Makefiles

- `make` is available everywhere
- it scales well from trivial to complex

</script></section><section data-markdown><script type="text/template">

### Real life examples

- [container build system](https://github.com/pymor/docker/blob/main/Makefile)
- [project setup](https://gist.githubusercontent.com/renefritze/425c4d02d315f246ba58ea3a0c6432e2/raw/ef752f59af47a048634e803ca7ccbd2e10a8b4f5/Makefile)

</script></section></section><section ><section data-markdown><script type="text/template">

# Aside: Program Input

~~Edit script for different parameters~~

Make script accept config file or cli args input

</script></section><section data-markdown><script type="text/template">

### Benefits

1. Parameter studies in parallel
2. increases Reproducibility
3. Clean history

</script></section></section><section ><section data-markdown><script type="text/template">

# Continuous Integration / Distribution

(CI/CD)

</script></section><section data-markdown><script type="text/template">

### What is CI/CD?

Service to automatically run workflow on your source.

</script></section><section data-markdown><script type="text/template">

### Platforms

1. Gitlab CI
2. Github Actions
3. Azure Pipelines
4. Circle CI
5. A dozen more

</script></section><section data-markdown><script type="text/template">

### Examples

- Make sure code style is followed
- Run your test suite on every git push for multiple configurations, [prevent merging with failures](https://github.com/WWU-AMM/pytimings/settings/branch_protection_rules/19373418)
- Build and distribute your documentation for git tags
- [Complex example](https://zivgitlab.uni-muenster.de/pymor/pymor/-/pipelines/134461)
- Trigger other workflows

</script></section><section data-markdown><script type="text/template">

### Gitlab CI

- Simpler to use with custom docker images
- Possible to run service containers
- Pages infrastructure with authentication

</script></section><section data-markdown><script type="text/template">

### Github Actions

- [Huge number](https://github.com/marketplace?type=actions) of pre-configured steps (Actions)
- [Dependabot](https://github.com/renefritze/pymor/pull/74)
- Pages easier with custom domains

</script></section></section><section ><section data-markdown><script type="text/template">

# Templating

</script></section><section data-markdown><script type="text/template">

### Example

<pre class="python"><code data-trim data-noescape>
import jinja2
template_string = """
# My Project is available for
{%- for py in python %}
{{loop.index}}. {{py}}
{%- endfor -%}
"""
tpl = jinja2.Template(template_string)
print(tpl.render(pythons=['3.9', '3.10']))
</code></pre>

<pre class="markdown"><code data-trim data-noescape>
# My Project is available for
1. 3.9
2. 3.10
</code></pre>

</script></section><section data-markdown><script type="text/template">

### Use cases

- Parameter Studies
- [Code generation](https://zivgitlab.uni-muenster.de/ag-ohlberger/dune-community/dune-xt/-/raw/master/python/scripts/generate_compare_functions.py)
- [Composable Dockerfiles](https://zivgitlab.uni-muenster.de/ag-ohlberger/dune-community/docker/-/raw/main/debian/python_dbg/Dockerfile.in)
- [Cookiecutters](https://cookiecutter.readthedocs.io/en/2.0.2/)

</script></section><section data-markdown><script type="text/template">

### CI Sanity

Always be sure you've commited resulting changes.

<pre class="bash"><code data-trim data-noescape>
./generate.py output_file
git diff --exit-code output_file
</code></pre>

</script></section><section data-markdown><script type="text/template">

## Cookiecutters

Generate entire projects from a [template](https://github.com/renefritze/cookiecutter-reveal).

</script></section></section><section ><section data-markdown><script type="text/template">

# Versioning

</script></section><section data-markdown><script type="text/template">

## Version info from git

<pre class="bash"><code data-trim data-noescape>
$ git describe --tags --dirty
2021.2.0-256-g2692a0e30
</code></pre>

Python + CMake based projects: [versioneer](https://github.com/python-versioneer/python-versioneer)

</script></section></section><section ><section data-markdown><script type="text/template">

# Releases

</script></section><section data-markdown><script type="text/template">

### Strategy

1. Determine git-hash that will become the release point
2. git tag it and push the tag
3. Usual CI runs for the commit+tag
4. Have extra steps at the end

</script></section><section data-markdown><script type="text/template">

## 4. Extra steps

- [upload](https://raw.githubusercontent.com/WWU-AMM/pytimings/main/.github/workflows/deploy.yml) to your
package repository
- Release announcements (Email, Twitter)

</script></section></section><section ><section data-markdown><script type="text/template">

# Automate bug finding

</script></section><section data-markdown><script type="text/template">

## git bisect run

[Tutorial](https://git-scm.com/book/en/v2/Git-Tools-Debugging-with-Git)

</script></section></section><section  data-markdown><script type="text/template">

# The end

[![](qrcode.png)](https://github.com/renefritze/22-rse-day)
</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

  // default options to init reveal.js
  var defaultOptions = {
    controls: true,
    progress: true,
    history: true,
    center: true,
    transition: 'default', // none/fade/slide/convex/concave/zoom
    plugins: [
      RevealMarkdown,
      RevealHighlight,
      RevealZoom,
      RevealNotes,
      RevealMath
    ]
  };

      // options from URL query string
            var queryOptions = Reveal().getQueryHash() || {};

            var options = extend(defaultOptions, {"transition":"none","controls":true,"slideNumber":false}, queryOptions);
        </script>


    <script>
      Reveal.initialize(options);
    </script>
    </body>
</html>
